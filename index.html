<script type="text/babel">
function App() {
  const [breakLength, setBreakLength] = React.useState(5);
  const [sessionLength, setSessionLength] = React.useState(25);
  const [timeLeft, setTimeLeft] = React.useState(25 * 60);
  const [isSession, setIsSession] = React.useState(true);
  const [running, setRunning] = React.useState(false);

  const intervalRef = React.useRef(null);
  const beepRef = React.useRef(null);

  const formatTime = (t) => {
    const m = String(Math.floor(t / 60)).padStart(2, "0");
    const s = String(t % 60).padStart(2, "0");
    return `${m}:${s}`;
  };

  const increment = (type) => {
    if (running) return;
    if (type === "break" && breakLength < 60) setBreakLength(breakLength + 1);
    if (type === "session" && sessionLength < 60) {
      setSessionLength(sessionLength + 1);
      setTimeLeft((sessionLength + 1) * 60);
    }
  };

  const decrement = (type) => {
    if (running) return;
    if (type === "break" && breakLength > 1) setBreakLength(breakLength - 1);
    if (type === "session" && sessionLength > 1) {
      setSessionLength(sessionLength - 1);
      setTimeLeft((sessionLength - 1) * 60);
    }
  };

  const tick = () => {
    setTimeLeft(prev => {
      if (prev === 0) {
        beepRef.current.play();
        if (isSession) {
          setIsSession(false);
          return breakLength * 60;
        } else {
          setIsSession(true);
          return sessionLength * 60;
        }
      }
      return prev - 1;
    });
  };

  const startStop = () => {
    if (running) {
      clearInterval(intervalRef.current);
      setRunning(false);
    } else {
      intervalRef.current = setInterval(tick, 1000);
      setRunning(true);
    }
  };

  const reset = () => {
    clearInterval(intervalRef.current);
    setRunning(false);
    setBreakLength(5);
    setSessionLength(25);
    setTimeLeft(25 * 60);
    setIsSession(true);
    beepRef.current.pause();
    beepRef.current.currentTime = 0;
  };

  React.useEffect(() => {
    return () => clearInterval(intervalRef.current);
  }, []);

  return (
    <div className="clock">
      <div className="length-control">
        <div className="control">
          <div id="break-label">Break Length</div>
          <button id="break-decrement" onClick={() => decrement("break")}>-</button>
          <span id="break-length">{breakLength}</span>
          <button id="break-increment" onClick={() => increment("break")}>+</button>
        </div>

        <div className="control">
          <div id="session-label">Session Length</div>
          <button id="session-decrement" onClick={() => decrement("session")}>-</button>
          <span id="session-length">{sessionLength}</span>
          <button id="session-increment" onClick={() => increment("session")}>+</button>
        </div>
      </div>

      <div id="timer-label">{isSession ? "Session" : "Break"}</div>
      <div id="time-left">{formatTime(timeLeft)}</div>

      <div>
        <button id="start_stop" onClick={startStop}>Start / Stop</button>
        <button id="reset" onClick={reset}>Reset</button>
      </div>

      <audio
        id="beep"
        ref={beepRef}
        src="https://cdn.freecodecamp.org/testable-projects-fcc/audio/BeepSound.wav"
      />
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById("app"));
</script>
